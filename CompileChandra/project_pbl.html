<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compile Chandra</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;500&family=Fira+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166d96;
            --accent-color: #47b5ff;
            --light-bg: #f5f9ff;
            --dark-bg: #1e293b;
            --text-color: #333;
            --light-text: #f5f5f5;
            --border-radius: 16px;
            --box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s cubic-bezier(.4,2,.6,1);
            --bg-gradient: linear-gradient(135deg, #e3e9f7 0%, #e8f0ff 60%, #f6eaff 100%);
            --header-bg: #1e293b;
            --section-gradient: linear-gradient(120deg, rgba(255,255,255,0.92) 60%, #e3e9f7 100%);
            --output-gradient: linear-gradient(120deg, #f5f9ff 60%, #e3e9f7 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            min-height: 100vh;
            color: var(--text-color);
            line-height: 1.6;
            background: var(--bg-gradient);
            font-family: 'Segoe UI', 'Montserrat', Arial, sans-serif;
            position: relative;
            z-index: 0;
            overflow-x: hidden;
        }
        
        /* Subtle SVG noise overlay for texture */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            pointer-events: none;
            z-index: 1;
            opacity: 0.10;
            background: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><filter id="noiseFilter"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" stitchTiles="stitch"/></filter><rect width="100" height="100" filter="url(%23noiseFilter)"/></svg>');
        }
        
        header {
            background: var(--header-bg);
            color: var(--light-text);
            padding: 36px 0 28px 0;
            text-align: center;
            margin-bottom: 36px;
            border-radius: var(--border-radius);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.18);
            position: relative;
            z-index: 2;
        }
        
        h1 {
            font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
            font-size: 2.8rem;
            font-weight: 700;
            letter-spacing: 0.03em;
            margin-bottom: 10px;
            text-shadow: 0 2px 12px rgba(0,0,0,0.10);
        }

        h2, h3, .summary-title, label {
            font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
            font-weight: 600;
            letter-spacing: 0.01em;
        }
        
        label {
            font-size: 1.08rem;
        }
        
        .language-description {
            font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
        }
        
        .reference-tab, .reference-content h3 {
            font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
        }
        
        .result-summary {
            font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
        }
        
        .code-editor, .parse-tree, .reference-example {
            font-family: 'Fira Mono', 'Consolas', 'Courier New', monospace;
            font-size: 1.08rem;
        }
        
        .section {
            background: var(--section-gradient);
            border-radius: var(--border-radius);
            padding: 36px 36px 32px 36px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.10);
            border: 1.5px solid #e3e9f7;
            position: relative;
            z-index: 2;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 13px 26px;
            background-color: #e0e0e0;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            cursor: pointer;
            transition: var(--transition);
            margin-right: 7px;
            font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
            font-weight: 500;
            font-size: 1.13rem;
            letter-spacing: 0.01em;
            border: none;
            outline: none;
        }
        
        .tab.active {
            background-color: var(--primary-color);
            color: #fff;
            box-shadow: 0 2px 12px rgba(71,181,255,0.10);
        }
        
        .tab:hover:not(.active) {
            background: #dbeafe;
            color: var(--primary-color);
        }
        
        .content-container {
            display: none;
        }
        
        .content-container.active {
            display: block;
        }
        
        .input-container {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
        }
        
        select, input, textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        select {
            width: 200px;
            cursor: pointer;
        }
        
        .flex-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .flex-column {
            display: flex;
            flex-direction: column;
        }
        
        .code-container {
            flex: 1;
            min-width: 420px;
            max-width: 800px;
        }
        
        .code-editor {
            height: 540px;
            min-width: 100%;
            max-width: 100%;
            font-family: 'Fira Mono', 'Courier New', monospace;
            padding: 18px;
            background-color: #282c34;
            color: #abb2bf;
            line-height: 1.5;
            overflow: auto;
            border-radius: var(--border-radius);
            border: none;
            resize: vertical;
            font-size: 1.13rem;
        }
        
        .result-container {
            flex: 1;
            min-width: 300px;
            max-height: 700px;
            overflow-y: auto;
        }
        
        .result-box {
            min-height: 400px;
            background: var(--output-gradient);
            border-radius: var(--border-radius);
            padding: 22px 18px 18px 18px;
            overflow: auto;
            box-shadow: 0 4px 24px 0 rgba(31, 38, 135, 0.10);
            border: 2.5px solid transparent;
            background-clip: padding-box, border-box;
            border-image: linear-gradient(120deg, #b6c6e6 0%, #47b5ff 100%) 1;
            animation: fadeIn 0.7s;
            position: relative;
            z-index: 2;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        button {
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            padding: 13px 28px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            font-family: 'Montserrat', 'Segoe UI', Arial, sans-serif;
            font-size: 1.08rem;
            letter-spacing: 0.01em;
            transition: var(--transition);
            align-self: flex-start;
            box-shadow: 0 2px 8px rgba(71,181,255,0.08);
        }
        
        button:hover, button:focus {
            background-color: var(--secondary-color);
            color: #fff;
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 4px 16px rgba(71,181,255,0.13);
        }
        
        .token-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .token-table th, .token-table td {
            border: 1px solid #e0e7ff;
            padding: 12px 10px;
            text-align: left;
            font-size: 1.04rem;
        }
        
        .token-table th {
            background: linear-gradient(90deg, var(--primary-color) 60%, var(--accent-color) 100%);
            color: #fff;
            letter-spacing: 0.03em;
        }
        
        .token-table tr:nth-child(even) {
            background-color: #f5f9ff;
        }
        
        .token-table tr:hover {
            background: #e3f0fa;
            transition: background 0.2s;
        }
        
        .token-summary {
            margin-bottom: 20px;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
        }
        
        .summary-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .parse-tree {
            font-family: 'Fira Mono', 'Courier New', monospace;
            white-space: pre;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            font-size: 1.1rem;
            line-height: 1.5;
            color: #2c3e50;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            overflow-x: auto;
        }
        
        .parse-tree pre {
            margin: 0;
            padding: 0;
            font-family: inherit;
        }
        
        .reference-dropdown {
            position: relative;
            overflow: hidden;
        }
        
        .reference-dropdown.dynamic-bg {
            transition: background 0.6s cubic-bezier(.4,2,.6,1);
            background: linear-gradient(120deg, rgba(255,255,255,0.7) 60%, var(--primary-color) 100%);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.10);
            border: 1.5px solid rgba(255,255,255,0.25);
        }
        
        .reference-dropdown .dropdown-header {
            background-color: var(--primary-color);
            color: white;
            padding: 12px;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .dropdown-content {
            display: none;
            background-color: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            padding: 15px;
        }
        
        .dropdown-content.show {
            display: block;
        }
        
        .reference-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 18px;
        }
        
        .reference-tab {
            padding: 8px 16px;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
            font-size: 1.08rem;
            font-weight: 500;
            letter-spacing: 0.01em;
        }
        
        .reference-tab.active {
            box-shadow: 0 2px 8px rgba(71,181,255,0.08);
        }
        
        .reference-content {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .reference-content.active {
            display: block;
        }
        
        .reference-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .reference-table th, .reference-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        .reference-table th {
            background-color: #f2f2f2;
        }
        
        .reference-example {
            font-family: 'Fira Mono', 'Courier New', monospace;
            font-size: 1.01rem;
        }
        
        .language-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
            padding: 12px 0 0 0;
        }
        
        .language-icon {
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255,255,255,0.85);
            box-shadow: 0 4px 16px rgba(0,0,0,0.10);
            transition: transform 0.4s cubic-bezier(.4,2,.6,1), box-shadow 0.4s;
        }
        
        .language-icon.animated {
            transform: scale(1.18) rotate(-8deg);
            box-shadow: 0 8px 32px rgba(0,0,0,0.18);
        }
        
        .language-description {
            font-size: 1.13rem;
            color: #333;
            font-weight: 500;
            letter-spacing: 0.01em;
        }
        
        .reference-divider {
            width: 100%;
            height: 1.5px;
            background: linear-gradient(90deg, #e0e7ff 0%, #b6c6e6 100%);
            margin: 18px 0 18px 0;
            border-radius: 2px;
            opacity: 0.7;
        }
        
        .result-summary {
            background: linear-gradient(90deg, #eaf6ff 60%, #f5f9ff 100%);
            border-left: 6px solid var(--primary-color);
            padding: 14px 22px;
            border-radius: 12px;
            margin-bottom: 18px;
            font-size: 1.11rem;
            color: #1e293b;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        
        @media (max-width: 768px) {
            .flex-row {
                flex-direction: column;
            }
            .code-container, .result-container {
                width: 100%;
                min-width: unset;
                max-width: unset;
            }
            .code-editor {
                height: 320px;
                min-width: 100%;
                max-width: 100%;
            }
        }

        .optimization-options {
            margin: 15px 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 1rem;
            color: #1e293b;
        }

        .checkbox-container input {
            margin-right: 10px;
        }

        .optimization-steps {
            background-color: #1e293b;
            padding: 20px;
            border-radius: 12px;
            color: #e2e8f0;
            font-family: 'Fira Mono', monospace;
        }

        .optimization-step {
            padding: 10px;
            border-bottom: 1px solid #334155;
            margin-bottom: 10px;
        }

        .step-title {
            color: #60a5fa;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .step-description {
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .optimization-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 8px;
        }

        .badge-constant {
            background-color: #3b82f6;
        }

        .badge-dead {
            background-color: #ef4444;
        }

        .badge-common {
            background-color: #10b981;
        }

        .badge-strength {
            background-color: #8b5cf6;
        }

        /* Enhanced IR Generator Styles */
        #ir-content .section {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        #ir-content .code-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        #ir-content input[type="text"] {
            font-size: 1.1rem;
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            transition: all 0.3s ease;
            background: #ffffff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        #ir-content input[type="text"]:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            outline: none;
        }

        #ir-content input[type="text"]::placeholder {
            color: #94a3b8;
        }

        #ir-content button {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            padding: 14px 28px;
            font-size: 1.1rem;
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
            border: none;
            color: white;
            font-weight: 600;
        }

        #ir-content button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(37, 99, 235, 0.3);
        }

        #ir-content .result-box {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .ir-results {
            padding: 25px;
        }

        .ir-code-block {
            background-color: #1e293b;
            padding: 25px;
            border-radius: 16px;
            font-family: 'Fira Mono', monospace;
            margin: 15px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #334155;
        }

        .ir-line {
            padding: 10px 15px;
            border-bottom: 1px solid #334155;
            color: #e2e8f0;
            font-size: 1.1rem;
            line-height: 1.6;
            transition: all 0.3s ease;
            border-radius: 8px;
            margin: 4px 0;
        }

        .ir-line:hover {
            background-color: #2d3a4f;
            transform: translateX(5px);
        }

        .ir-line .operator {
            color: #60a5fa;
            font-weight: bold;
            padding: 0 4px;
        }

        .ir-line .temp-var {
            color: #34d399;
            font-weight: bold;
            padding: 0 4px;
        }

        .ir-line .equals {
            color: #f472b6;
            font-weight: bold;
            padding: 0 4px;
        }

        .summary-title {
            color: #1e293b;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #60a5fa;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .summary-title::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 20px;
            background: #3b82f6;
            border-radius: 2px;
        }

        .temp-vars-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            padding: 20px;
            background-color: #1e293b;
            border-radius: 16px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #334155;
        }

        .temp-var {
            background-color: #334155;
            padding: 10px 20px;
            border-radius: 8px;
            font-family: 'Fira Mono', monospace;
            font-size: 1rem;
            color: #34d399;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border: 1px solid #475569;
        }

        .temp-var:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            background-color: #475569;
        }

        /* Animation for code blocks */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ir-code-block {
            animation: fadeInUp 0.5s ease-out;
        }

        .ir-line {
            animation: fadeInUp 0.3s ease-out;
            animation-fill-mode: both;
        }

        .ir-line:nth-child(1) { animation-delay: 0.1s; }
        .ir-line:nth-child(2) { animation-delay: 0.2s; }
        .ir-line:nth-child(3) { animation-delay: 0.3s; }
        .ir-line:nth-child(4) { animation-delay: 0.4s; }
        .ir-line:nth-child(5) { animation-delay: 0.5s; }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            #ir-content .code-container {
                padding: 15px;
            }

            .ir-code-block {
                padding: 15px;
            }

            .ir-line {
                font-size: 1rem;
                padding: 8px 12px;
            }

            .temp-var {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Compile Chandra - The Next Gen Compiler
            </h1>
            <p>Compile and Run Code , Analyze code and generate parse trees with ease</p>
        </div>
    </header>
    <!-- Code Runner UI Start -->
    <div class="container" style="margin-bottom: 32px;">
        <div class="section">
            <h2>Online Code Runner</h2>
            <form id="codeRunnerForm">
                <label for="runner-language">Select Language:</label>
                <select id="runner-language" name="language">
                    <option value="c">C</option>
                    <option value="cpp">C++</option>
                    <option value="python">Python</option>
                    <option value="javascript">JavaScript</option>
                </select>
                <br><br>
                <label for="runner-code">Enter your code:</label><br>
                <textarea id="runner-code" name="code" rows="10" cols="80" class="code-editor" placeholder="Type or paste your code here..."></textarea><br><br>
                <button type="submit">Run Code</button>
            </form>
            <h3>Output:</h3>
            <pre id="runner-output" class="result-box" style="min-height: 40px;"></pre>
            <h3>Error:</h3>
            <pre id="runner-error" class="result-box" style="min-height: 40px; color: #c00;"></pre>
        </div>
    </div>
    <!-- Code Runner UI End -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('codeRunnerForm');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const code = document.getElementById('runner-code').value;
                    const language = document.getElementById('runner-language').value;
                    document.getElementById('runner-output').textContent = 'Running...';
                    document.getElementById('runner-error').textContent = '';
                    try {
                        const response = await fetch('http://127.0.0.1:5000/run', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ code, language })
                        });
                        const result = await response.json();
                        document.getElementById('runner-output').textContent = result.output || '';
                        document.getElementById('runner-error').textContent = result.error || '';
                    } catch (err) {
                        document.getElementById('runner-output').textContent = '';
                        document.getElementById('runner-error').textContent = 'Error connecting to backend.';
                    }
                });
            }
        });
    </script>
    
    <div class="container">
        <div class="tab-container">
            <div class="tab active" data-tab="lexical">Lexical Analyzer</div>
            <div class="tab" data-tab="parse">Parse Tree Generator</div>
            <div class="tab" data-tab="ir">Intermediate Code</div>
            <div class="tab" data-tab="optimize">Code Optimization</div>
        </div>
        
        <!-- Lexical Analyzer Section -->
        <div class="content-container active" id="lexical-content">
            <div class="section">
                <h2>Lexical Analyzer</h2>
                <div class="input-container">
                    <label for="language-select">Select Language:</label>
                    <select id="language-select">
                        <option value="cpp">C++</option>
                        <option value="c">C</option>
                        <option value="java">Java</option>
                        <option value="python">Python</option>
                        <option value="js">JavaScript</option>
                    </select>
                </div>
                
                <div class="flex-row">
                    <div class="code-container">
                        <label for="code-input">Enter Source Code:</label>
                        <textarea id="code-input" class="code-editor" placeholder="Type or paste your code here..."></textarea>
                        <button id="analyze-btn" style="margin-top: 15px;">Analyze Code</button>
                    </div>
                    
                    <div class="result-container">
                        <label>Token Analysis Results:</label>
                        <div class="result-box" id="token-result">
                            <!-- Token results will be displayed here -->
                            <div class="token-summary">
                                <div class="summary-title">SUMMARY OF TOKENS:</div>
                                <table class="token-table">
                                    <tr>
                                        <th>Token Type</th>
                                        <th>Count</th>
                                    </tr>
                                    <tr>
                                        <td>Preprocessor Directive</td>
                                        <td>2</td>
                                    </tr>
                                    <tr>
                                        <td>Keyword</td>
                                        <td>5</td>
                                    </tr>
                                    <tr>
                                        <td>Identifier</td>
                                        <td>8</td>
                                    </tr>
                                    <tr>
                                        <td>Special Symbol</td>
                                        <td>12</td>
                                    </tr>
                                </table>
                            </div>
                            
                            <div class="detailed-tokens">
                                <div class="summary-title">DETAILED TOKEN LIST:</div>
                                <table class="token-table">
                                    <tr>
                                        <th>No.</th>
                                        <th>Token Type</th>
                                        <th>Token Value</th>
                                    </tr>
                                    <tr>
                                        <td>1</td>
                                        <td>Preprocessor Directive</td>
                                        <td><code>#include</code></td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>Header File</td>
                                        <td><code>&lt;iostream&gt;</code></td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>Keyword</td>
                                        <td><code>using</code></td>
                                    </tr>
                                    <tr>
                                        <td>4</td>
                                        <td>Keyword</td>
                                        <td><code>namespace</code></td>
                                    </tr>
                                    <tr>
                                        <td>5</td>
                                        <td>Standard Namespace</td>
                                        <td><code>std</code></td>
                                    </tr>
                                    <tr>
                                        <td>6</td>
                                        <td>Special Symbol</td>
                                        <td><code>;</code></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Parse Tree Generator Section -->
        <div class="content-container" id="parse-content">
            <div class="section">
                <h2>Parse Tree Generator</h2>
                
                <div class="flex-row">
                    <div class="code-container">
                        <label for="expression-input">Enter Expression:</label>
                        <input type="text" id="expression-input" placeholder="e.g., a=b*c+d-e" style="width: 100%;">
                        <p style="margin-bottom: 15px; font-size: 14px; color: #666;">
                            Supported operators: =, +, -, *, /, %<br>
                            Variables and numbers are supported.
                        </p>
                        <button id="parse-btn">Generate Parse Tree</button>
                    </div>
                    
                    <div class="result-container">
                        <label>Parse Tree Result:</label>
                        <div class="result-box">
                            <div>
                                <div class="summary-title">Expression: a=b*c+d-e</div>
                                <div class="parse-tree">
        =
       / \
      a   -
         / \
        +   e
       / \
      *   d
     / \
    b   c
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Intermediate Code Generation Section -->
        <div class="content-container" id="ir-content">
            <div class="section">
                <h2>Intermediate Code Generator</h2>
                
                <div class="flex-row">
                    <div class="code-container">
                        <label for="ir-expression-input">Enter Expression:</label>
                        <input type="text" id="ir-expression-input" placeholder="e.g., a=b*c+d-e" style="width: 100%;">
                        <p style="margin-bottom: 15px; font-size: 14px; color: #666;">
                            Supported operators: =, +, -, *, /, %<br>
                            Variables and numbers are supported.
                        </p>
                        <button id="ir-generate-btn">Generate IR</button>
                    </div>
                    
                    <div class="result-container">
                        <label>Intermediate Code Result:</label>
                        <div class="result-box">
                            <div class="ir-results">
                                <div class="summary-title">Three-Address Code:</div>
                                <div id="ir-code" class="ir-code">
                                    <!-- IR code will be displayed here -->
                                </div>
                                
                                <div class="summary-title" style="margin-top: 20px;">Temporary Variables:</div>
                                <div id="temp-vars" class="temp-vars">
                                    <!-- Temporary variables will be displayed here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Code Optimization Section -->
        <div class="content-container" id="optimize-content">
            <div class="section">
                <h2>Code Optimization</h2>
                
                <div class="flex-row">
                    <div class="code-container">
                        <label for="optimize-expression-input">Enter Expression:</label>
                        <input type="text" id="optimize-expression-input" placeholder="e.g., a=2*3+b*2" style="width: 100%;">
                        <p style="margin-bottom: 15px; font-size: 14px; color: #666;">
                            Supported operators: =, +, -, *, /, %<br>
                            Variables and numbers are supported.
                        </p>
                        <div class="optimization-options">
                            <label class="checkbox-container">
                                <input type="checkbox" id="constant-folding" checked>
                                <span class="checkmark"></span>
                                Constant Folding
                            </label>
                            <label class="checkbox-container">
                                <input type="checkbox" id="dead-code" checked>
                                <span class="checkmark"></span>
                                Dead Code Elimination
                            </label>
                            <label class="checkbox-container">
                                <input type="checkbox" id="common-subexpr" checked>
                                <span class="checkmark"></span>
                                Common Subexpression Elimination
                            </label>
                            <label class="checkbox-container">
                                <input type="checkbox" id="strength-reduction" checked>
                                <span class="checkmark"></span>
                                Strength Reduction
                            </label>
                        </div>
                        <button id="optimize-btn">Optimize Code</button>
                    </div>
                    
                    <div class="result-container">
                        <label>Optimization Results:</label>
                        <div class="result-box">
                            <div class="optimization-results">
                                <div class="summary-title">Original IR Code:</div>
                                <div id="original-ir" class="ir-code"></div>
                                
                                <div class="summary-title" style="margin-top: 20px;">Optimized IR Code:</div>
                                <div id="optimized-ir" class="ir-code"></div>
                                
                                <div class="summary-title" style="margin-top: 20px;">Optimization Steps:</div>
                                <div id="optimization-steps" class="optimization-steps"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Language Reference Section -->
        <div class="section reference-dropdown">
            <div class="dropdown-header">
                <span>Language Reference Guide</span>
                <span class="dropdown-icon">▼</span>
            </div>
            <div class="dropdown-content">
                <div class="input-container">
                    <label for="reference-language">Select Language:</label>
                    <select id="reference-language">
                        <option value="cpp">C++</option>
                        <option value="c">C</option>
                        <option value="java">Java</option>
                        <option value="python">Python</option>
                        <option value="js">JavaScript</option>
                    </select>
                </div>
                <div class="language-info" id="language-info">
                    <span class="language-icon" id="language-icon">🟦</span>
                    <span class="language-description" id="language-description">C++ is a powerful general-purpose programming language.</span>
                </div>
                <div class="reference-divider"></div>
                
                <div class="reference-tabs">
                    <div class="reference-tab active" data-ref="keywords">Keywords</div>
                    <div class="reference-tab" data-ref="operators">Operators</div>
                    <div class="reference-tab" data-ref="separators">Separators</div>
                    <div class="reference-tab" data-ref="identifiers">Identifiers</div>
                    <div class="reference-tab" data-ref="literals">Literals</div>
                </div>
                
                <div class="reference-content active" id="keywords-content">
                    <h3>Keywords in C++</h3>
                    <p>Keywords are reserved words that have special meanings in the language.</p>
                    <table class="reference-table">
                        <tr>
                            <th>Keyword</th>
                            <th>Description</th>
                            <th>Example</th>
                        </tr>
                        <tr>
                            <td>int</td>
                            <td>Integer data type</td>
                            <td><span class="reference-example">int x = 5;</span></td>
                        </tr>
                        <tr>
                            <td>if</td>
                            <td>Conditional statement</td>
                            <td><span class="reference-example">if (x > 0) { ... }</span></td>
                        </tr>
                        <tr>
                            <td>for</td>
                            <td>Loop construct</td>
                            <td><span class="reference-example">for (int i = 0; i < 10; i++) { ... }</span></td>
                        </tr>
                        <tr>
                            <td>while</td>
                            <td>Loop construct</td>
                            <td><span class="reference-example">while (x > 0) { ... }</span></td>
                        </tr>
                        <tr>
                            <td>class</td>
                            <td>Class definition</td>
                            <td><span class="reference-example">class MyClass { ... };</span></td>
                        </tr>
                        <tr>
                            <td>return</td>
                            <td>Return statement</td>
                            <td><span class="reference-example">return value;</span></td>
                        </tr>
                        <tr>
                            <td>void</td>
                            <td>No return type</td>
                            <td><span class="reference-example">void function() { ... }</span></td>
                        </tr>
                        <tr>
                            <td>const</td>
                            <td>Constant value</td>
                            <td><span class="reference-example">const int MAX = 100;</span></td>
                        </tr>
                        <tr>
                            <td>static</td>
                            <td>Static storage</td>
                            <td><span class="reference-example">static int count = 0;</span></td>
                        </tr>
                        <tr>
                            <td>namespace</td>
                            <td>Namespace declaration</td>
                            <td><span class="reference-example">namespace myspace { ... }</span></td>
                        </tr>
                    </table>
                </div>
                
                <div class="reference-content" id="operators-content">
                    <h3>Operators in C++</h3>
                    <p>Operators are symbols that tell the compiler to perform specific operations.</p>
                    <table class="reference-table">
                        <tr>
                            <th>Operator</th>
                            <th>Type</th>
                            <th>Example</th>
                        </tr>
                        <tr>
                            <td>+, -, *, /</td>
                            <td>Arithmetic</td>
                            <td><span class="reference-example">a + b, a - b, a * b, a / b</span></td>
                        </tr>
                        <tr>
                            <td>==, !=, >, <, >=, <=</td>
                            <td>Comparison</td>
                            <td><span class="reference-example">a == b, a != b, a > b</span></td>
                        </tr>
                        <tr>
                            <td>&&, ||, !</td>
                            <td>Logical</td>
                            <td><span class="reference-example">a && b, a || b, !a</span></td>
                        </tr>
                        <tr>
                            <td>=, +=, -=, *=, /=</td>
                            <td>Assignment</td>
                            <td><span class="reference-example">a = b, a += b, a -= b</span></td>
                        </tr>
                        <tr>
                            <td>&, |, ^, ~, <<, >></td>
                            <td>Bitwise</td>
                            <td><span class="reference-example">a & b, a | b, a ^ b, ~a</span></td>
                        </tr>
                    </table>
                </div>
                
                <div class="reference-content" id="separators-content">
                    <h3>Separators in C++</h3>
                    <p>Separators are symbols used to separate different parts of the code.</p>
                    <table class="reference-table">
                        <tr>
                            <th>Separator</th>
                            <th>Description</th>
                            <th>Example</th>
                        </tr>
                        <tr>
                            <td>{ }</td>
                            <td>Braces - Block of code</td>
                            <td><span class="reference-example">if (condition) { statements; }</span></td>
                        </tr>
                        <tr>
                            <td>( )</td>
                            <td>Parentheses - Function calls, conditions</td>
                            <td><span class="reference-example">function(param1, param2)</span></td>
                        </tr>
                        <tr>
                            <td>[ ]</td>
                            <td>Brackets - Arrays</td>
                            <td><span class="reference-example">int array[10];</span></td>
                        </tr>
                        <tr>
                            <td>;</td>
                            <td>Semicolon - End of statement</td>
                            <td><span class="reference-example">int x = 10;</span></td>
                        </tr>
                        <tr>
                            <td>,</td>
                            <td>Comma - Separator for parameters, declarations</td>
                            <td><span class="reference-example">int x, y, z;</span></td>
                        </tr>
                        <tr>
                            <td>.</td>
                            <td>Dot - Member access</td>
                            <td><span class="reference-example">object.member</span></td>
                        </tr>
                        <tr>
                            <td>::</td>
                            <td>Scope resolution</td>
                            <td><span class="reference-example">std::cout</span></td>
                        </tr>
                    </table>
                </div>
                
                <div class="reference-content" id="identifiers-content">
                    <h3>Identifiers in C++</h3>
                    <p>Identifiers are names given to entities such as variables, functions, classes, etc.</p>
                    <table class="reference-table">
                        <tr>
                            <th>Rule</th>
                            <th>Description</th>
                            <th>Example</th>
                        </tr>
                        <tr>
                            <td>First character</td>
                            <td>Must begin with a letter or underscore</td>
                            <td><span class="reference-example">count, _value</span></td>
                        </tr>
                        <tr>
                            <td>Subsequent characters</td>
                            <td>Can contain letters, digits, underscores</td>
                            <td><span class="reference-example">user1, total_sum</span></td>
                        </tr>
                        <tr>
                            <td>Case sensitivity</td>
                            <td>Identifiers are case-sensitive</td>
                            <td><span class="reference-example">Count ≠ count</span></td>
                        </tr>
                        <tr>
                            <td>Reserved words</td>
                            <td>Cannot use keywords as identifiers</td>
                            <td><span class="reference-example">int, class, return (invalid as identifiers)</span></td>
                        </tr>
                    </table>
                </div>
                
                <div class="reference-content" id="literals-content">
                    <h3>Literals in C++</h3>
                    <p>Literals are fixed values that are directly written in the code.</p>
                    <table class="reference-table">
                        <tr>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Example</th>
                        </tr>
                        <tr>
                            <td>Integer</td>
                            <td>Whole numbers</td>
                            <td><span class="reference-example">42, 0, -10, 0xFF (hex), 077 (octal)</span></td>
                        </tr>
                        <tr>
                            <td>Floating Point</td>
                            <td>Decimal numbers</td>
                            <td><span class="reference-example">3.14, 2.5e2, .5, 1.0f</span></td>
                        </tr>
                        <tr>
                            <td>Character</td>
                            <td>Single character</td>
                            <td><span class="reference-example">'a', '5', '\n', '\t'</span></td>
                        </tr>
                        <tr>
                            <td>String</td>
                            <td>Sequence of characters</td>
                            <td><span class="reference-example">"Hello", "123", "", "x"</span></td>
                        </tr>
                        <tr>
                            <td>Boolean</td>
                            <td>Logical values</td>
                            <td><span class="reference-example">true, false</span></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Tab switching for main sections
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                const tabId = tab.getAttribute('data-tab');
                document.querySelectorAll('.content-container').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabId}-content`).classList.add('active');
            });
        });
        
        // Toggle language reference dropdown
        const dropdownHeader = document.querySelector('.dropdown-header');
        const dropdownContent = document.querySelector('.dropdown-content');
        const dropdownIcon = document.querySelector('.dropdown-icon');
        
        dropdownHeader.addEventListener('click', () => {
            dropdownContent.classList.toggle('show');
            dropdownIcon.textContent = dropdownContent.classList.contains('show') ? '▲' : '▼';
        });
        
        // Tab switching for language reference
        const refTabs = document.querySelectorAll('.reference-tab');
        refTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                refTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                const refId = tab.getAttribute('data-ref');
                document.querySelectorAll('.reference-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${refId}-content`).classList.add('active');
            });
        });
        
        // Language data for icons, colors, and descriptions
        const languageData = {
            cpp: {
                name: 'C++',
                icon: `<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="20" cy="20" r="20" fill="#00599C"/><text x="50%" y="55%" text-anchor="middle" fill="#fff" font-size="18" font-family="Arial" dy=".3em">C++</text></svg>`,
                color: '#00599C',
                backgroundColor: '#e3f0fa',
                description: 'C++ is a powerful general-purpose programming language, widely used for system/software development and game programming.'
            },
            c: {
                name: 'C',
                icon: `<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="20" cy="20" r="20" fill="#283593"/><text x="50%" y="55%" text-anchor="middle" fill="#fff" font-size="20" font-family="Arial" dy=".3em">C</text></svg>`,
                color: '#283593',
                backgroundColor: '#e3e6fa',
                description: 'C is a foundational procedural programming language, known for its efficiency and control over system resources.'
            },
            java: {
                name: 'Java',
                icon: `<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="20" cy="20" r="20" fill="#E76F00"/><text x="50%" y="55%" text-anchor="middle" fill="#fff" font-size="16" font-family="Arial" dy=".3em">Java</text></svg>`,
                color: '#E76F00',
                backgroundColor: '#fff3e6',
                description: 'Java is a versatile, object-oriented language used for building cross-platform applications and enterprise solutions.'
            },
            python: {
                name: 'Python',
                icon: `<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="20" cy="20" r="20" fill="#FFD43B"/><text x="50%" y="55%" text-anchor="middle" fill="#306998" font-size="16" font-family="Arial" dy=".3em">Py</text></svg>`,
                color: '#FFD43B',
                backgroundColor: '#fffbe6',
                description: 'Python is a popular, easy-to-learn language known for its readability and wide range of applications.'
            },
            js: {
                name: 'JavaScript',
                icon: `<svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="20" cy="20" r="20" fill="#F7DF1E"/><text x="50%" y="55%" text-anchor="middle" fill="#323330" font-size="14" font-family="Arial" dy=".3em">JS</text></svg>`,
                color: '#F7DF1E',
                backgroundColor: '#fffde6',
                description: 'JavaScript is the language of the web, enabling interactive and dynamic web applications.'
            }
        };
        
        // Change language reference content based on selection
        const langRefSelect = document.getElementById('reference-language');
        langRefSelect.addEventListener('change', () => {
            const lang = langRefSelect.value;
            // Update heading
            document.querySelectorAll('.reference-content h3').forEach(heading => {
                const contentType = heading.parentElement.id.split('-')[0];
                heading.textContent = `${contentType.charAt(0).toUpperCase() + contentType.slice(1)} in ${languageData[lang].name}`;
            });
            // Update icon and description
            const iconEl = document.getElementById('language-icon');
            iconEl.classList.remove('animated');
            void iconEl.offsetWidth; // trigger reflow for animation
            iconEl.innerHTML = languageData[lang].icon;
            setTimeout(() => iconEl.classList.add('animated'), 50);
            document.getElementById('language-description').textContent = languageData[lang].description;
            // Update background color
            const refDropdown = document.querySelector('.reference-dropdown');
            refDropdown.classList.add('dynamic-bg');
            refDropdown.style.backgroundColor = languageData[lang].backgroundColor;
        });
        // Set initial language info and color
        window.addEventListener('DOMContentLoaded', () => {
            const lang = langRefSelect.value;
            const iconEl = document.getElementById('language-icon');
            iconEl.innerHTML = languageData[lang].icon;
            setTimeout(() => iconEl.classList.add('animated'), 100);
            document.getElementById('language-description').textContent = languageData[lang].description;
            document.querySelector('.reference-dropdown').style.backgroundColor = languageData[lang].backgroundColor;
        });
        
        // Lexical Analyzer Implementation
        class LexicalAnalyzer {
            constructor() {
                this.keywords = new Set([
                    'if', 'else', 'while', 'for', 'do', 'switch', 'case', 'break', 'continue',
                    'return', 'void', 'int', 'float', 'double', 'char', 'string', 'bool',
                    'true', 'false', 'null', 'class', 'public', 'private', 'protected',
                    'static', 'final', 'const', 'using', 'namespace', 'include', 'import'
                ]);
                
                this.operators = new Set([
                    '+', '-', '*', '/', '%', '=', '==', '!=', '>', '<', '>=', '<=',
                    '&&', '||', '!', '&', '|', '^', '~', '<<', '>>', '+=', '-=', '*=', '/='
                ]);
                
                this.separators = new Set([
                    '(', ')', '{', '}', '[', ']', ';', ',', '.', ':', '::'
                ]);
            }

            analyze(code) {
                const tokens = [];
                let currentToken = '';
                let line = 1;
                let column = 1;

                for (let i = 0; i < code.length; i++) {
                    const char = code[i];
                    
                    // Handle whitespace
                    if (char === ' ' || char === '\t') {
                        if (currentToken) {
                            tokens.push(this.classifyToken(currentToken, line, column - currentToken.length));
                            currentToken = '';
                        }
                        column++;
                        continue;
                    }

                    // Handle newlines
                    if (char === '\n') {
                        if (currentToken) {
                            tokens.push(this.classifyToken(currentToken, line, column - currentToken.length));
                            currentToken = '';
                        }
                        line++;
                        column = 1;
                        continue;
                    }

                    // Handle comments
                    if (char === '/' && code[i + 1] === '/') {
                        if (currentToken) {
                            tokens.push(this.classifyToken(currentToken, line, column - currentToken.length));
                            currentToken = '';
                        }
                        while (i < code.length && code[i] !== '\n') i++;
                        line++;
                        column = 1;
                        continue;
                    }

                    // Handle operators and separators
                    if (this.operators.has(char) || this.separators.has(char)) {
                        if (currentToken) {
                            tokens.push(this.classifyToken(currentToken, line, column - currentToken.length));
                            currentToken = '';
                        }
                        tokens.push({
                            type: this.operators.has(char) ? 'Operator' : 'Separator',
                            value: char,
                            line,
                            column
                        });
                        column++;
                        continue;
                    }

                    currentToken += char;
                    column++;
                }

                // Handle last token if exists
                if (currentToken) {
                    tokens.push(this.classifyToken(currentToken, line, column - currentToken.length));
                }

                return tokens;
            }

            classifyToken(token, line, column) {
                if (this.keywords.has(token.toLowerCase())) {
                    return { type: 'Keyword', value: token, line, column };
                }
                if (/^[0-9]+(\.[0-9]+)?$/.test(token)) {
                    return { type: 'Number', value: token, line, column };
                }
                if (/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(token)) {
                    return { type: 'Identifier', value: token, line, column };
                }
                if (/^"[^"]*"$/.test(token) || /^'[^']*'$/.test(token)) {
                    return { type: 'String', value: token, line, column };
                }
                return { type: 'Unknown', value: token, line, column };
            }
        }

        // Parse Tree Generator Implementation
        class ParseTreeGenerator {
            constructor() {
                this.precedence = {
                    '=': 1,
                    '+': 2, '-': 2,
                    '*': 3, '/': 3, '%': 3
                };
            }

            generateTree(expression) {
                const tokens = this.tokenize(expression);
                return this.buildTree(tokens);
            }

            tokenize(expression) {
                const tokens = [];
                let current = '';
                
                for (let i = 0; i < expression.length; i++) {
                    const char = expression[i];
                    
                    if (char === ' ') continue;
                    
                    if (this.isOperator(char)) {
                        if (current) {
                            tokens.push({ type: 'operand', value: current });
                            current = '';
                        }
                        tokens.push({ type: 'operator', value: char });
                    } else {
                        current += char;
                    }
                }
                
                if (current) {
                    tokens.push({ type: 'operand', value: current });
                }
                
                return tokens;
            }

            isOperator(char) {
                return ['+', '-', '*', '/', '%', '='].includes(char);
            }

            buildTree(tokens) {
                const output = [];
                const operators = [];
                
                for (const token of tokens) {
                    if (token.type === 'operand') {
                        output.push(token);
                    } else {
                        while (operators.length > 0 && 
                               this.precedence[operators[operators.length - 1].value] >= this.precedence[token.value]) {
                            output.push(operators.pop());
                        }
                        operators.push(token);
                    }
                }
                
                while (operators.length > 0) {
                    output.push(operators.pop());
                }
                
                return this.constructTree(output);
            }

            constructTree(postfix) {
                const stack = [];
                
                for (const token of postfix) {
                    if (token.type === 'operand') {
                        stack.push({ value: token.value, left: null, right: null });
                    } else {
                        const right = stack.pop();
                        const left = stack.pop();
                        stack.push({ value: token.value, left, right });
                    }
                }
                
                return stack[0];
            }

            // Improved systematic vertical tree printer
            treeToString(node) {
                if (!node) return '';
                // Helper to recursively build lines and return [lines, width, rootPos]
                function buildLines(node) {
                    if (!node) return [[''], 0, 0];
                    const val = String(node.value);
                    const valWidth = val.length;

                    // Leaf node
                    if (!node.left && !node.right) {
                        return [[val], valWidth, Math.floor(valWidth / 2)];
                    }

                    // Build left and right subtrees
                    const [leftLines, leftWidth, leftRoot] = node.left ? buildLines(node.left) : [[''], 0, 0];
                    const [rightLines, rightWidth, rightRoot] = node.right ? buildLines(node.right) : [[''], 0, 0];

                    // Calculate positions
                    const minSpace = 2; // Minimum space between subtrees
                    const between = leftWidth > 0 && rightWidth > 0 ? minSpace : 0;
                    const width = leftWidth + between + rightWidth;
                    const rootPos = leftWidth + Math.floor(between / 2);

                    // First line: node value centered
                    let firstLine = ' '.repeat(leftWidth) + val + ' '.repeat(rightWidth);

                    // Second line: connectors
                    let secondLine = '';
                    if (node.left) {
                        secondLine += ' '.repeat(leftRoot) + '/' + ' '.repeat(leftWidth - leftRoot - 1);
                    } else {
                        secondLine += ' '.repeat(leftWidth);
                    }
                    secondLine += ' '.repeat(valWidth);
                    if (node.right) {
                        secondLine += ' '.repeat(rightRoot) + '\\' + ' '.repeat(rightWidth - rightRoot - 1);
                    } else {
                        secondLine += ' '.repeat(rightWidth);
                    }

                    // Merge left and right lines
                    const maxLen = Math.max(leftLines.length, rightLines.length);
                    const merged = [];
                    for (let i = 0; i < maxLen; i++) {
                        const leftLine = leftLines[i] || ' '.repeat(leftWidth);
                        const rightLine = rightLines[i] || ' '.repeat(rightWidth);
                        merged.push(leftLine + ' '.repeat(between) + rightLine);
                    }

                    return [[firstLine, secondLine, ...merged], width + valWidth, rootPos + Math.floor(valWidth / 2)];
                }
                return buildLines(node)[0].join('\n');
            }
        }

        // Handle the analyze code button
        const analyzeBtn = document.getElementById('analyze-btn');
        const lexicalAnalyzer = new LexicalAnalyzer();
        
        analyzeBtn.addEventListener('click', () => {
            const codeInput = document.getElementById('code-input').value;
            const lang = document.getElementById('language-select').value;
            
            if (!codeInput.trim()) {
                alert("Please enter some code to analyze.");
                return;
            }
            
            const tokens = lexicalAnalyzer.analyze(codeInput);
            
            // Count token types
            const tokenCounts = {};
            tokens.forEach(token => {
                tokenCounts[token.type] = (tokenCounts[token.type] || 0) + 1;
            });
            
            // Update summary table
            const summaryTable = document.querySelector('.token-summary .token-table');
            summaryTable.innerHTML = `
                <tr>
                    <th>Token Type</th>
                    <th>Count</th>
                </tr>
                ${Object.entries(tokenCounts).map(([type, count]) => `
                    <tr>
                        <td>${type}</td>
                        <td>${count}</td>
                    </tr>
                `).join('')}
            `;
            
            // Update detailed tokens table
            const detailedTable = document.querySelector('.detailed-tokens .token-table');
            detailedTable.innerHTML = `
                <tr>
                    <th>No.</th>
                    <th>Token Type</th>
                    <th>Token Value</th>
                    <th>Line</th>
                    <th>Column</th>
                </tr>
                ${tokens.map((token, index) => `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${token.type}</td>
                        <td><code>${token.value}</code></td>
                        <td>${token.line}</td>
                        <td>${token.column}</td>
                    </tr>
                `).join('')}
            `;
        });
        
        // Handle the parse tree generation button
        const parseBtn = document.getElementById('parse-btn');
        const parseTreeGenerator = new ParseTreeGenerator();
        
        parseBtn.addEventListener('click', () => {
            const expressionInput = document.getElementById('expression-input').value;
            
            if (!expressionInput.trim()) {
                alert("Please enter an expression to parse.");
                return;
            }
            
            try {
                const tree = parseTreeGenerator.generateTree(expressionInput);
                const treeString = parseTreeGenerator.treeToString(tree);
                
                const parseResultBox = document.querySelector('#parse-content .result-box');
                parseResultBox.innerHTML = `
                    <div class="result-summary">
                        <b>Output Summary:</b> This section displays the parse tree for the given expression.
                    </div>
                    <div>
                        <div class="summary-title">Expression: ${expressionInput}</div>
                        <div class="parse-tree">
                            <pre>${treeString}</pre>
                        </div>
                    </div>
                `;
            } catch (error) {
                alert("Error parsing expression: " + error.message);
            }
        });

        // Intermediate Code Generator Implementation
        class IRGenerator {
            constructor() {
                this.tempCounter = 1;
                this.tempVars = new Set();
            }

            generate(expression) {
                this.tempCounter = 1;
                this.tempVars.clear();
                
                const tokens = this.tokenize(expression);
                const postfix = this.toPostfix(tokens);
                return this.generateThreeAddressCode(postfix);
            }

            tokenize(expression) {
                const tokens = [];
                let current = '';
                
                for (let i = 0; i < expression.length; i++) {
                    const char = expression[i];
                    
                    if (char === ' ') continue;
                    
                    if (this.isOperator(char)) {
                        if (current) {
                            tokens.push({ type: 'operand', value: current });
                            current = '';
                        }
                        tokens.push({ type: 'operator', value: char });
                    } else {
                        current += char;
                    }
                }
                
                if (current) {
                    tokens.push({ type: 'operand', value: current });
                }
                
                return tokens;
            }

            isOperator(char) {
                return ['+', '-', '*', '/', '%', '='].includes(char);
            }

            getPrecedence(operator) {
                switch (operator) {
                    case '=': return 1;
                    case '+': case '-': return 2;
                    case '*': case '/': case '%': return 3;
                    default: return 0;
                }
            }

            toPostfix(tokens) {
                const output = [];
                const operators = [];
                
                for (const token of tokens) {
                    if (token.type === 'operand') {
                        output.push(token);
                    } else {
                        while (operators.length > 0 && 
                               this.getPrecedence(operators[operators.length - 1].value) >= this.getPrecedence(token.value)) {
                            output.push(operators.pop());
                        }
                        operators.push(token);
                    }
                }
                
                while (operators.length > 0) {
                    output.push(operators.pop());
                }
                
                return output;
            }

            generateThreeAddressCode(postfix) {
                const stack = [];
                const code = [];
                
                for (const token of postfix) {
                    if (token.type === 'operand') {
                        stack.push(token.value);
                    } else {
                        const right = stack.pop();
                        const left = stack.pop();
                        
                        if (token.value === '=') {
                            code.push(`${left} = ${right}`);
                            stack.push(left);
                        } else {
                            const temp = `t${this.tempCounter++}`;
                            this.tempVars.add(temp);
                            code.push(`${temp} = ${left} ${token.value} ${right}`);
                            stack.push(temp);
                        }
                    }
                }
                
                return {
                    code: code,
                    tempVars: Array.from(this.tempVars)
                };
            }
        }

        // Handle the IR generation button
        const irGenerateBtn = document.getElementById('ir-generate-btn');
        const irGenerator = new IRGenerator();
        
        irGenerateBtn.addEventListener('click', () => {
            const expressionInput = document.getElementById('ir-expression-input').value;
            
            if (!expressionInput.trim()) {
                alert("Please enter an expression to generate IR.");
                return;
            }
            
            try {
                const ir = irGenerator.generate(expressionInput);
                
                // Update IR code display with styled elements
                document.getElementById('ir-code').innerHTML = `
                    <div class="ir-code-block">
                        ${ir.code.map(line => {
                            const parts = line.split(/([=+\-*/])/);
                            return `
                                <div class="ir-line">
                                    ${parts.map(part => {
                                        if (part === '=') return `<span class="equals">${part}</span>`;
                                        if (['+', '-', '*', '/', '%'].includes(part)) return `<span class="operator">${part}</span>`;
                                        if (part.startsWith('t')) return `<span class="temp-var">${part}</span>`;
                                        return part;
                                    }).join('')}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

                // Update temporary variables display with styled elements
                document.getElementById('temp-vars').innerHTML = `
                    <div class="temp-vars-list">
                        ${ir.tempVars.map(temp => `
                            <div class="temp-var">${temp}</div>
                        `).join('')}
                    </div>
                `;
                
            } catch (error) {
                alert("Error generating IR: " + error.message);
            }
        });

        // Enhanced IR Generator with Optimizations
        class OptimizedIRGenerator extends IRGenerator {
            constructor() {
                super();
                this.optimizationSteps = [];
            }

            optimize(expression, options) {
                this.optimizationSteps = [];
                const ir = this.generate(expression);
                let optimizedCode = [...ir.code];

                if (options.constantFolding) {
                    optimizedCode = this.constantFolding(optimizedCode);
                }

                if (options.commonSubexpr) {
                    optimizedCode = this.commonSubexpressionElimination(optimizedCode);
                }

                if (options.strengthReduction) {
                    optimizedCode = this.strengthReduction(optimizedCode);
                }

                if (options.deadCode) {
                    optimizedCode = this.deadCodeElimination(optimizedCode);
                }

                return {
                    original: ir.code,
                    optimized: optimizedCode,
                    steps: this.optimizationSteps
                };
            }

            constantFolding(code) {
                const optimized = [];
                const constants = new Map();

                for (const line of code) {
                    const [target, expr] = line.split('=').map(s => s.trim());
                    const parts = expr.split(/([+\-*/])/).map(s => s.trim());
                    
                    if (parts.length === 3) {
                        const [left, op, right] = parts;
                        const leftVal = constants.get(left) ?? left;
                        const rightVal = constants.get(right) ?? right;
                        
                        if (!isNaN(leftVal) && !isNaN(rightVal)) {
                            const result = eval(`${leftVal} ${op} ${rightVal}`);
                            constants.set(target, result);
                            this.optimizationSteps.push({
                                type: 'constant',
                                original: line,
                                optimized: `${target} = ${result}`,
                                description: `Folded constant expression: ${expr} = ${result}`
                            });
                            continue;
                        }
                    }
                    optimized.push(line);
                }

                return optimized;
            }

            commonSubexpressionElimination(code) {
                const optimized = [];
                const expressions = new Map();

                for (const line of code) {
                    const [target, expr] = line.split('=').map(s => s.trim());
                    
                    if (expressions.has(expr)) {
                        const existingTemp = expressions.get(expr);
                        this.optimizationSteps.push({
                            type: 'common',
                            original: line,
                            optimized: `${target} = ${existingTemp}`,
                            description: `Reused common subexpression: ${expr}`
                        });
                        optimized.push(`${target} = ${existingTemp}`);
                    } else {
                        expressions.set(expr, target);
                        optimized.push(line);
                    }
                }

                return optimized;
            }

            deadCodeElimination(code) {
                const usedVars = new Set();
                const optimized = [];

                for (const line of code) {
                    const [target, expr] = line.split('=').map(s => s.trim());
                    const vars = expr.split(/[+\-*/]/).map(s => s.trim());
                    vars.forEach(v => usedVars.add(v));
                }

                for (const line of code) {
                    const [target] = line.split('=').map(s => s.trim());
                    if (usedVars.has(target) || !target.startsWith('t')) {
                        optimized.push(line);
                    } else {
                        this.optimizationSteps.push({
                            type: 'dead',
                            original: line,
                            optimized: '',
                            description: `Removed dead code: ${line}`
                        });
                    }
                }

                return optimized;
            }

            strengthReduction(code) {
                const optimized = [];
                
                for (const line of code) {
                    const [target, expr] = line.split('=').map(s => s.trim());
                    const parts = expr.split(/([+\-*/])/).map(s => s.trim());
                    
                    if (parts.length === 3) {
                        const [left, op, right] = parts;
                        let newExpr = expr;
                        let description = '';

                        // Multiplication by 2^n
                        if (op === '*' && !isNaN(right)) {
                            const power = Math.log2(Number(right));
                            if (Number.isInteger(power)) {
                                newExpr = `${left} << ${power}`;
                                description = `Replaced multiplication by ${right} with left shift by ${power}`;
                            }
                        }
                        // Multiplication by 2
                        else if (op === '*' && right === '2') {
                            newExpr = `${left} + ${left}`;
                            description = 'Replaced multiplication by 2 with addition';
                        }
                        // Division by 2^n
                        else if (op === '/' && !isNaN(right)) {
                            const power = Math.log2(Number(right));
                            if (Number.isInteger(power)) {
                                newExpr = `${left} >> ${power}`;
                                description = `Replaced division by ${right} with right shift by ${power}`;
                            }
                        }

                        if (newExpr !== expr) {
                            this.optimizationSteps.push({
                                type: 'strength',
                                original: line,
                                optimized: `${target} = ${newExpr}`,
                                description: description
                            });
                            optimized.push(`${target} = ${newExpr}`);
                            continue;
                        }
                    }
                    optimized.push(line);
                }

                return optimized;
            }
        }

        // Handle the optimization button
        const optimizeBtn = document.getElementById('optimize-btn');
        const optimizedIRGenerator = new OptimizedIRGenerator();
        
        optimizeBtn.addEventListener('click', () => {
            const expressionInput = document.getElementById('optimize-expression-input').value;
            const options = {
                constantFolding: document.getElementById('constant-folding').checked,
                commonSubexpr: document.getElementById('common-subexpr').checked,
                deadCode: document.getElementById('dead-code').checked,
                strengthReduction: document.getElementById('strength-reduction').checked
            };
            
            if (!expressionInput.trim()) {
                alert("Please enter an expression to optimize.");
                return;
            }
            
            try {
                const result = optimizedIRGenerator.optimize(expressionInput, options);
                
                // Display original IR
                document.getElementById('original-ir').innerHTML = `
                    <div class="ir-code-block">
                        ${result.original.map(line => {
                            const parts = line.split(/([=+\-*/])/);
                            return `
                                <div class="ir-line">
                                    ${parts.map(part => {
                                        if (part === '=') return `<span class="equals">${part}</span>`;
                                        if (['+', '-', '*', '/', '%'].includes(part)) return `<span class="operator">${part}</span>`;
                                        if (part.startsWith('t')) return `<span class="temp-var">${part}</span>`;
                                        return part;
                                    }).join('')}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

                // Display optimized IR
                document.getElementById('optimized-ir').innerHTML = `
                    <div class="ir-code-block">
                        ${result.optimized.map(line => {
                            const parts = line.split(/([=+\-*/])/);
                            return `
                                <div class="ir-line">
                                    ${parts.map(part => {
                                        if (part === '=') return `<span class="equals">${part}</span>`;
                                        if (['+', '-', '*', '/', '%'].includes(part)) return `<span class="operator">${part}</span>`;
                                        if (part.startsWith('t')) return `<span class="temp-var">${part}</span>`;
                                        return part;
                                    }).join('')}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

                // Display optimization steps
                document.getElementById('optimization-steps').innerHTML = `
                    ${result.steps.map(step => `
                        <div class="optimization-step">
                            <div class="step-title">
                                ${step.type === 'constant' ? 'Constant Folding' : 
                                  step.type === 'dead' ? 'Dead Code Elimination' : 
                                  step.type === 'strength' ? 'Strength Reduction' :
                                  'Common Subexpression Elimination'}
                                <span class="optimization-badge badge-${step.type}">
                                    ${step.type === 'constant' ? 'CF' : 
                                      step.type === 'dead' ? 'DCE' : 
                                      step.type === 'strength' ? 'SR' :
                                      'CSE'}
                                </span>
                            </div>
                            <div class="step-description">
                                ${step.description}
                            </div>
                        </div>
                    `).join('')}
                `;
                
            } catch (error) {
                alert("Error optimizing code: " + error.message);
            }
        });
    </script>
</body>
</html>
